<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>2</storyId>
    <title>Non-Interactive CLI Mode</title>
    <status>drafted</status>
    <generatedAt>2025-11-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/5-2-non-interactive-cli-mode.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>CI/CD pipeline engineer</asA>
    <iWant>MoonFRP operations to run non-interactively with clear exit codes</iWant>
    <soThat>automation scripts execute reliably without prompts</soThat>
    <tasks>- Implement global flags in `moonfrp.sh` (AC: 1,2,5)
  - Parse `-y/--yes`, `-q/--quiet`, `--timeout` (AC: 1,2,5)
  - Override `safe_read` for non-interactive mode (AC: 1)
  - Override `log` for quiet mode (AC: 2)
- Implement exit code constants and usage (AC: 3,4)
  - Map errors to specific exit codes (AC: 4)
- Expose commands via CLI dispatcher (AC: 6)
  - `start|stop|restart|status` (AC: 6)
  - `export|import|validate` (AC: 6)
  - `bulk`, `search`, `tag`, `optimize` (AC: 6)
- Implement timeout handling with trap (AC: 5)
- Update help text (AC: 7)
- Tests (AC: 1â€“7)
  - `test_noninteractive_yes_flag`
  - `test_noninteractive_quiet_flag`
  - `test_exit_codes`
  - `test_timeout_handling`
  - `test_help_text`
  - `test_all_commands_cli_accessible`</tasks>
  </story>

  <acceptanceCriteria>1. `--yes` / `-y` flag bypasses all confirmations
2. `--quiet` / `-q` flag suppresses non-essential output
3. Exit code 0 for success, non-zero for failure
4. Specific exit codes for failures (1=general, 2=validation, 3=permission, 4=not-found, 5=timeout)
5. Operations timeout after reasonable duration
6. All menu-driven functions accessible via CLI arguments
7. Help text for all commands: `moonfrp &lt;command&gt; --help`</acceptanceCriteria>

  <artifacts>
    <docs></docs>
    <code></code>
    <dependencies></dependencies>
  </artifacts>

  <constraints>Ensure non-interactive mode rejects interactive menu usage with an error; keep logging performance acceptable in both modes.</constraints>
  <interfaces></interfaces>
  <tests>
    <standards></standards>
    <locations></locations>
    <ideas></ideas>
  </tests>
</story-context>
